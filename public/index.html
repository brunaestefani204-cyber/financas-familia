<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>FinanÃ§as da FamÃ­lia</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body{margin:0;font-family:Segoe UI,Arial;background:#f2f4f7;color:#333}
header{background:#1f2937;color:#fff;padding:20px;text-align:center}
nav{display:flex;background:#111827}
nav button{flex:1;padding:14px;border:none;background:none;color:#9ca3af;cursor:pointer}
nav button.active{color:#fff;border-bottom:3px solid #22c55e}
main{max-width:1100px;margin:auto;padding:20px}
section{display:none}
section.active{display:block}
.card,.box{background:#fff;border-radius:12px;padding:16px;margin-bottom:16px;box-shadow:0 2px 6px rgba(0,0,0,.08)}
.cards{display:grid;grid-template-columns:repeat(auto-fit,minmax(160px,1fr));gap:12px}
input,select,button{width:100%;padding:10px;margin-top:6px;border-radius:8px;border:1px solid #ccc}
button{background:#22c55e;color:#fff;font-weight:bold;border:none}
.small{font-size:13px;color:#666}
.bar{background:#22c55e;height:16px;border-radius:6px}
.bar-wrap{background:#e5e7eb;border-radius:6px;margin:6px 0}
</style>
</head>

<body>

<header>
<h1>FinanÃ§as da FamÃ­lia</h1>
<p>Controle financeiro mensal</p>
</header>

<nav>
<button class="active" onclick="aba('painel',this)">Painel</button>
<button onclick="aba('transacoes',this)">TransaÃ§Ãµes</button>
<button onclick="aba('metas',this)">Metas</button>
<button onclick="aba('categorias',this)">Categorias</button>
</nav>

<main>

<!-- PAINEL -->
<section id="painel" class="active">

<div class="box">
<label>MÃªs</label>
<select id="mesSelect"></select>
<label>Ano</label>
<select id="anoSelect"></select>
</div>

<div class="cards">
<div class="card"><strong>Entradas</strong><div id="entradas"></div></div>
<div class="card"><strong>Despesas</strong><div id="despesas"></div></div>
<div class="card"><strong>Investimentos</strong><div id="investimentos"></div></div>
<div class="card"><strong>Saldo do mÃªs</strong><div id="saldo"></div></div>
</div>

<div class="box">
<h3>ðŸ“Š Despesas por Categoria</h3>
<div id="graficoCategoria"></div>
</div>

<div class="box">
<h3>ðŸ“‰ EvoluÃ§Ã£o Mensal (Ano)</h3>
<div id="graficoEvolucao"></div>
</div>

</section>

<!-- TRANSAÃ‡Ã•ES -->
<section id="transacoes">
<div class="box">
<select id="tipo">
<option value="entrada">Entrada</option>
<option value="despesa">Despesa</option>
<option value="investimento">Investimento</option>
</select>

<input id="valor" type="number" placeholder="Valor">

<select id="categoria"></select>

<button onclick="addTransacao()">Adicionar</button>
</div>
</section>

<!-- METAS -->
<section id="metas">
<div class="box">
<p>Metas anuais continuam funcionando como antes.</p>
</div>
</section>

<!-- CATEGORIAS -->
<section id="categorias">
<div class="box">
<input id="novaCategoria" placeholder="Nome da categoria">
<select id="classificacaoCategoria">
<option>Adulto</option>
<option>CrianÃ§a</option>
<option>FamÃ­lia</option>
</select>
<button onclick="addCategoria()">Adicionar Categoria</button>
<ul id="listaCategorias"></ul>
</div>
</section>

</main>

<script>
const meses=["Janeiro","Fevereiro","MarÃ§o","Abril","Maio","Junho","Julho","Agosto","Setembro","Outubro","Novembro","Dezembro"]
const anoAtual=new Date().getFullYear()

let mesAtual=0
let anoAtualSel=anoAtual

let categorias=JSON.parse(localStorage.getItem("categorias"))||[
 {nome:"AlimentaÃ§Ã£o",classificacao:"FamÃ­lia"},
 {nome:"Moradia",classificacao:"FamÃ­lia"},
 {nome:"EducaÃ§Ã£o",classificacao:"CrianÃ§a"},
 {nome:"Lazer",classificacao:"FamÃ­lia"}
]

let transacoes=JSON.parse(localStorage.getItem("transacoes"))||[]

function aba(id,b){
document.querySelectorAll("section").forEach(s=>s.classList.remove("active"))
document.getElementById(id).classList.add("active")
document.querySelectorAll("nav button").forEach(x=>x.classList.remove("active"))
b.classList.add("active")
}

function salvar(){
localStorage.setItem("categorias",JSON.stringify(categorias))
localStorage.setItem("transacoes",JSON.stringify(transacoes))
}

function initMesAno(){
mesSelect.innerHTML=meses.map((m,i)=>`<option value="${i}">${m}</option>`).join("")
anoSelect.innerHTML=Array.from({length:5},(_,i)=>anoAtual-2+i).map(a=>`<option>${a}</option>`).join("")
mesSelect.value=0
anoSelect.value=anoAtual
mesSelect.onchange=()=>{mesAtual=+mesSelect.value;atualizar()}
anoSelect.onchange=()=>{anoAtualSel=+anoSelect.value;atualizar()}
}

function renderCategorias(){
categoria.innerHTML=categorias.map(c=>`<option>${c.nome}</option>`).join("")
listaCategorias.innerHTML=categorias.map(c=>`<li>${c.nome} <span class="small">(${c.classificacao})</span></li>`).join("")
}

function addCategoria(){
categorias.push({nome:novaCategoria.value,classificacao:classificacaoCategoria.value})
novaCategoria.value=""
salvar();renderCategorias()
}

function addTransacao(){
const cat=categorias.find(c=>c.nome===categoria.value)
transacoes.push({
 tipo:tipo.value,
 valor:+valor.value,
 categoria:cat.nome,
 classificacao:cat.classificacao,
 mes:mesAtual,
 ano:anoAtualSel
})
valor.value=""
salvar();atualizar()
}

function atualizar(){
const mesTrans=transacoes.filter(t=>t.mes===mesAtual && t.ano===anoAtualSel)

let e=0,d=0,i=0
mesTrans.forEach(t=>{
if(t.tipo==="entrada")e+=t.valor
if(t.tipo==="despesa")d+=t.valor
if(t.tipo==="investimento")i+=t.valor
})

entradas.innerText=e.toLocaleString("pt-BR",{style:"currency",currency:"BRL"})
despesas.innerText=d.toLocaleString("pt-BR",{style:"currency",currency:"BRL"})
investimentos.innerText=i.toLocaleString("pt-BR",{style:"currency",currency:"BRL"})
saldo.innerText=(e-d-i).toLocaleString("pt-BR",{style:"currency",currency:"BRL"})

renderGraficoCategoria(mesTrans)
renderGraficoEvolucao()
}

function renderGraficoCategoria(lista){
graficoCategoria.innerHTML=""
const total=lista.filter(t=>t.tipo==="despesa").reduce((a,b)=>a+b.valor,0)
const porCat={}
lista.filter(t=>t.tipo==="despesa").forEach(t=>{
porCat[t.categoria]=(porCat[t.categoria]||0)+t.valor
})

Object.entries(porCat).forEach(([k,v])=>{
const pct=(v/total*100)||0
graficoCategoria.innerHTML+=`
<div class="small">${k} (${v.toLocaleString("pt-BR",{style:"currency",currency:"BRL"})})</div>
<div class="bar-wrap"><div class="bar" style="width:${pct}%"></div></div>
`
})
}

function renderGraficoEvolucao(){
graficoEvolucao.innerHTML=""
for(let m=0;m<12;m++){
let total=transacoes.filter(t=>t.mes===m && t.ano===anoAtualSel && t.tipo==="despesa")
.reduce((a,b)=>a+b.valor,0)
const pct=total/100
graficoEvolucao.innerHTML+=`
<div class="small">${meses[m]}</div>
<div class="bar-wrap"><div class="bar" style="width:${pct}%"></div></div>
`
}
}

initMesAno()
renderCategorias()
atualizar()
</script>

</body>
</html>
